{% extends "dashboard_base.html" %}

{% block title %}Employee Profile - {{ employee_id }}{% endblock %}

{% block content %}
<div class="dashboard-header">
    <div class="header-content">
        <h1 class="neon-text">Employee Profile</h1>
        <p class="text-secondary">Viewing profile for user ID: {{ employee_id }}</p>
    </div>
</div>

<div class="profile-grid" id="profile-container">
    <div class="card loading-card">
        <div class="loading-spinner"></div>
        <p>Loading profile data...</p>
    </div>
</div>

<style>
.profile-grid {
    display: grid;
    grid-template-columns: 350px 1fr;
    gap: 2rem;
    margin-top: 2rem;
}

@media (max-width: 900px) {
    .profile-grid {
        grid-template-columns: 1fr;
    }
}

.profile-sidebar {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

.profile-card {
    background: rgba(30, 35, 45, 0.7);
    border: 1px solid rgba(0, 255, 255, 0.2);
    border-radius: 12px;
    padding: 2rem;
    text-align: center;
    position: relative;
    overflow: hidden;
}

.profile-avatar {
    width: 150px;
    height: 150px;
    border-radius: 50%;
    margin: 0 auto 1.5rem;
    border: 3px solid #00FFFF;
    box-shadow: 0 0 15px rgba(0, 255, 255, 0.4);
    object-fit: cover;
}

.profile-name {
    font-size: 1.5rem;
    color: #00FFFF;
    margin-bottom: 0.5rem;
    font-weight: 700;
}

.profile-role {
    color: #D4AF37;
    font-size: 0.9rem;
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 1.5rem;
}

.stats-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
    margin-top: 1rem;
}

.stat-item {
    background: rgba(10, 15, 31, 0.5);
    padding: 1rem;
    border-radius: 8px;
    border: 1px solid rgba(212, 175, 55, 0.1);
}

.stat-value {
    font-size: 1.25rem;
    color: #00FFFF;
    font-weight: 700;
}

.stat-label {
    font-size: 0.75rem;
    color: #8b949e;
    text-transform: uppercase;
}
</style>

{% endblock %}

{% block page_scripts %}
<script>
document.addEventListener('DOMContentLoaded', async () => {
    const container = document.getElementById('profile-container');
    const guildId = "{{ server.id }}";
    const userId = "{{ employee_id }}";
    
    try {
        const response = await fetch(`/api/server/${guildId}/employee/${userId}/profile`);
        const data = await response.json();
        
        if (data.success) {
            const p = data.profile;
            container.innerHTML = `
                <div class="profile-sidebar">
                    <div class="profile-card">
                        <img src="${p.avatar_url || 'https://cdn.discordapp.com/embed/avatars/0.png'}" class="profile-avatar">
                        <h2 class="profile-name">${p.display_name}</h2>
                        <div class="profile-role">${p.position || 'Employee'}</div>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <div class="stat-value">${p.stats.total_hours}h</div>
                                <div class="stat-label">Total Hours</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">${p.stats.weekly_hours}h</div>
                                <div class="stat-label">This Week</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="profile-main">
                    <div class="card">
                        <h3>Information</h3>
                        <p><strong>Department:</strong> ${p.department || 'General'}</p>
                        <p><strong>Hire Date:</strong> ${p.hire_date ? new Date(p.hire_date).toLocaleDateString() : 'N/A'}</p>
                        <p><strong>Bio:</strong> ${p.bio || 'No bio provided.'}</p>
                    </div>
                </div>
            `;
        } else {
            container.innerHTML = `<div class="card error-card">Error: ${data.error}</div>`;
        }
    } catch (err) {
        container.innerHTML = `<div class="card error-card">Failed to load profile.</div>`;
    }
});
</script>
{% endblock %}
